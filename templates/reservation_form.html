{% extends "base.html" %}
{% set title = "予約内容の入力" %}

{% block content %}
<section class="card">
  <div class="stepbar" aria-label="手順">
    <div class="step">1 予約開始</div>
    <div class="step">2 メール</div>
    <div class="step is-active">3 入力</div>
    <div class="step">4 受付</div>
  </div>

  <h1 class="h1">予約内容を入力</h1>
  <p class="help">
    入力項目は最小限です。分からない所は空欄でもOKです。
  </p>

  {% if error %}
    <div class="alert" role="alert" aria-live="polite">{{ error }}</div>
  {% endif %}

  <form method="post" class="form" novalidate>
    <div class="readonly">
      <div class="label">メール（変更できません）</div>
      <div class="value">{{ email }}</div>
    </div>

    <label class="label" for="patient_name">お名前（必須）</label>
    <input class="input" id="patient_name" name="patient_name" type="text" required
           autocomplete="name" value="{{ (form.patient_name if form else '') }}"
           placeholder="例：山田 太郎">

    <label class="label">希望日（最大3つ・任意）</label>
    <div class="grid3">
      <input class="input" name="preferred_date1" type="date" value="{{ (form.preferred_date1 if form else '') }}">
      <input class="input" name="preferred_date2" type="date" value="{{ (form.preferred_date2 if form else '') }}">
      <input class="input" name="preferred_date3" type="date" value="{{ (form.preferred_date3 if form else '') }}">
    </div>

    <label class="label" for="preferred_time">希望時間帯（任意）</label>
    <select class="input" id="preferred_time" name="preferred_time">
      <option value="">指定なし</option>
      <option value="morning">午前</option>
      <option value="afternoon">午後</option>
      <option value="evening">夕方</option>
    </select>

    <label class="label" for="note">伝えたいこと（任意）</label>
    <textarea class="textarea" id="note" name="note" rows="5"
      placeholder="例：聞こえにくいので連絡はメール希望。できれば○曜日が良い。">{{ (form.note if form else '') }}</textarea>

    <button class="button" type="submit">送信する</button>
    <a class="link" href="{{ url_for('public.email_input') }}">最初からやり直す</a>
  </form>
</section>
{% endblock %}

{% block title %}予約希望入力 | 人工内耳センター 予約リクエスト{% endblock %}

{% block content %}
{% set d = form_data or {} %}
<section class="card">
  <h1 class="page-title">初診外来 予約希望フォーム</h1>

  <p class="help-text">
    予約希望日を<strong>第1〜第3希望</strong>までご入力ください。<br>
    予約は職員が電子カルテの空き状況を確認後、メールで確定連絡します。
  </p>

  <div class="email-box">
    連絡先メール：{{ email }}
  </div>

  <form method="post" action="" class="form">
    <!-- 任意：診察券番号 -->
    <label class="label" for="chart_number">診察券番号（お持ちの方のみ）</label>
    <input
      type="text"
      id="chart_number"
      name="chart_number"
      class="input"
      inputmode="numeric"
      placeholder="例：1234567"
      value="{{ form_data.get('chart_number','') }}"
    >

    <!-- 紹介元 -->
    <label class="label" for="referring_hospital">紹介元医療機関名</label>
    <input
      type="text"
      id="referring_hospital"
      name="referring_hospital"
      class="input"
      placeholder="例：○○クリニック"
      value="{{ d.get('referring_hospital','') }}"
    >

    <hr class="divider">

    <!-- 氏名 -->
    <div class="grid-2">
      <div>
        <label class="label" for="last_name">お名前（姓）</label>
        <input
          type="text"
          id="last_name"
          name="last_name"
          class="input"
          required
          value="{{ d.get('last_name','') }}"
        >
      </div>
      <div>
        <label class="label" for="first_name">お名前（名）</label>
        <input
          type="text"
          id="first_name"
          name="first_name"
          class="input"
          required
          value="{{ d.get('first_name','') }}"
        >
      </div>
    </div>

    <div class="grid-2">
      <div>
        <label class="label" for="last_name_kana">フリガナ（セイ）</label>
        <input
          type="text"
          id="last_name_kana"
          name="last_name_kana"
          class="input"
          placeholder="例：ヨシダ"
          value="{{ d.get('last_name_kana','') }}"
        >
      </div>
      <div>
        <label class="label" for="first_name_kana">フリガナ（メイ）</label>
        <input
          type="text"
          id="first_name_kana"
          name="first_name_kana"
          class="input"
          placeholder="例：シゲル"
          value="{{ d.get('first_name_kana','') }}"
        >
      </div>
    </div>

    <!-- 生年月日・性別 -->
    <div class="grid-2">
      <div>
        <label class="label" for="birth_date">生年月日</label>
        <input
          type="date"
          id="birth_date"
          name="birth_date"
          class="input"
          required
          value="{{ form_data.get('birth_date','') }}"
        >
      </div>

      <div>
        <label class="label" for="sex">性別</label>
        <select id="sex" name="sex" class="input" required>
          <option value="" {% if d.get('sex','')=='' %}selected{% endif %}>選択してください</option>
          <option value="M" {% if d.get('sex','')=='M' %}selected{% endif %}>男性</option>
          <option value="F" {% if d.get('sex','')=='F' %}selected{% endif %}>女性</option>
          <option value="O" {% if d.get('sex','')=='O' %}selected{% endif %}>その他／回答しない</option>
        </select>
      </div>
    </div>

    <hr class="divider">

    <h2 class="section-title">予約希望日時（スロット方式）</h2>
    <p class="help-text">
      スロットは目安です。確定日時は職員確認後にご連絡します。
    </p>

    <!-- 第1希望 -->
    <fieldset class="fieldset">
      <legend class="legend">第1希望（必須）</legend>
      <div class="grid-2">
        <div>
          <label class="label" for="first_choice_date">日付</label>
          <input
            type="date"
            id="first_choice_date"
            name="first_choice_date"
            class="input"
            required
            value="{{ form_data.get('first_choice_date','') }}"
          >
        </div>
        <div>
          <label class="label" for="first_choice_time_slot">時間帯</label>
          <select id="first_choice_time_slot" name="first_choice_time_slot" class="input" required>
            <option value="" {% if form_data.get('first_choice_time_slot','')=='' %}selected{% endif %}>選択してください</option>
            <option value="am_early" {% if form_data.get('first_choice_time_slot','')=='am_early' %}selected{% endif %}>午前（早め）</option>
            <option value="am_late" {% if form_data.get('first_choice_time_slot','')=='am_late' %}selected{% endif %}>午前（遅め）</option>
            <option value="pm" {% if form_data.get('first_choice_time_slot','')=='pm' %}selected{% endif %}>午後</option>
          </select>
        </div>
      </div>
    </fieldset>

    <!-- 第2希望 -->
    <fieldset class="fieldset">
      <legend class="legend">第2希望（任意）</legend>
      <div class="grid-2">
        <div>
          <label class="label" for="second_choice_date">日付</label>
          <input
            type="date"
            id="second_choice_date"
            name="second_choice_date"
            class="input"
            value="{{ form_data.get('second_choice_date','') }}"
          >
        </div>
        <div>
          <label class="label" for="second_choice_time_slot">時間帯</label>
          <select id="second_choice_time_slot" name="second_choice_time_slot" class="input">
            <option value="" {% if form_data.get('second_choice_time_slot','')=='' %}selected{% endif %}>未選択</option>
            <option value="am_early" {% if form_data.get('second_choice_time_slot','')=='am_early' %}selected{% endif %}>午前（早め）</option>
            <option value="am_late" {% if form_data.get('second_choice_time_slot','')=='am_late' %}selected{% endif %}>午前（遅め）</option>
            <option value="pm" {% if form_data.get('second_choice_time_slot','')=='pm' %}selected{% endif %}>午後</option>
          </select>
        </div>
      </div>
    </fieldset>

    <!-- 第3希望 -->
    <fieldset class="fieldset">
      <legend class="legend">第3希望（任意）</legend>
      <div class="grid-2">
        <div>
          <label class="label" for="third_choice_date">日付</label>
          <input
            type="date"
            id="third_choice_date"
            name="third_choice_date"
            class="input"
            value="{{ form_data.get('third_choice_date','') }}"
          >
        </div>
        <div>
          <label class="label" for="third_choice_time_slot">時間帯</label>
          <select id="third_choice_time_slot" name="third_choice_time_slot" class="input">
            <option value="" {% if form_data.get('third_choice_time_slot','')=='' %}selected{% endif %}>未選択</option>
            <option value="am_early" {% if form_data.get('third_choice_time_slot','')=='am_early' %}selected{% endif %}>午前（早め）</option>
            <option value="am_late" {% if form_data.get('third_choice_time_slot','')=='am_late' %}selected{% endif %}>午前（遅め）</option>
            <option value="pm" {% if form_data.get('third_choice_time_slot','')=='pm' %}selected{% endif %}>午後</option>
          </select>
        </div>
      </div>
    </fieldset>

    <div class="actions">
      <button type="submit" class="button">予約希望を送信する</button>
    </div>

    <p class="note">
      ※入力内容に不備がある場合、職員からメールで確認することがあります。
    </p>
  </form>
</section>
{% endblock %}
